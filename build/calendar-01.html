<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8"/>
      <title>Smogey Calendar</title>
      <meta name="keywords" content="keywords"/>
      <meta name="description" content="description"/>
      <!--favicon-->
      <!--viewport-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"/>
      <!--styles-->
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css"/>
      <link rel="stylesheet" type="text/css" href="assets/css/app.min.css"/>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.css" rel="stylesheet"/>
      <script src="https://code.jquery.com/jquery-1.10.0.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcnL4h84dY1OeZV5yOV94LgZzRHjO8Wvw&amp;libraries=places"></script>
      <script src="assets/js/bundle.js"></script><!--[if lt IE 9]><!-->
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<!--<![endif]-->
    </head>
  <!--card-text-->
  <!--calendar-tooltip-->
  <body class="homepage">
    <div class="wrapper">
      <section class="main">
        <div class="container py-3">
          <article class="calendar-wrap">
            <div class="row mb-20">
              <div class="col-xs-12 px-0">
                <nav class="bread" aria-label="breadcrumb">
                  <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="#">Acceuil</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Le blog du développement durable</li>
                  </ol>
                </nav>
              </div>
            </div>
            <div class="row mb-20">
              <div class="col-md-12 px-0">
                <div class="clearfix bg-warning p-2">
                  <h4 class="d-inline-block text-white float-left">L'agenda des initiatives dans votre commune</h4><a class="d-inline-block btn btn-outline-warning float-right" role="button" href="index.html"><span>Retour</span></a>
                </div>
              </div>
            </div>
            <div class="row mb-20">
              <div id="calendar-01"></div>
              <div class="hide" id="popoverContent">
                <div class="row p-3">
                  <div class="col-sm-9 col-xs-12 mb-sm-3">
                    <p>71, rue de Tolbiac,<br/> PARIS 75013,<br/> Magasin vrac</p>
                    <button class="btn btn-success w-100 text-center" type="button" data-toggle="modal" data-target="#mapMarkerModal"> More information</button>
                  </div>
                  <div class="col-sm-3 col-xs-12"><img class="img-responsive m-auto" src="assets/img/calendar/pin-01.png"/></div>
                </div>
              </div>
            </div>
            <div class="row mx-0 mb-20"><a class="btn btn-pink" href="#plus-initiative" data-toggle="modal"><i class="fa fa-plus-circle"></i><span>Poposer un événement</span></a></div>
          </article>
        </div>
      </section>
    </div>
    <!--// Modal-->
    <div class="modal fade" id="mapMarkerModal" tabindex="-1" role="dialog" aria-labelledby="mapMarkerModalTitle" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header bg-pink text-white">
            <h4 class="modal-title">Naturalia Tolbiac</h4>
            <button class="btn-close" type="button" data-dismiss="modal" aria-label="Close"><span class="fa fa-close text-white" aria-hidden="true"></span></button>
          </div>
          <div class="modal-body">
            <div class="row mb-20">
              <div class="col-sm-6 mb-3"><img class="w-100" src="assets/img/map/map-modal-01.jpg"/></div>
              <div class="col-sm-6 mb-3">
                <div id="map-canvas" style="width: 100%; height: 200px;"></div>
              </div>
            </div>
            <p class="mb-0">Depuis quelques jours, la Ville de Tournai constate que des sacs poubelles d’ordures ménagères apparaissent à différents endroits de l’entité à des jours inappropriés alors que le calendrier de ramassage de ces poubelles.</p>
          </div>
          <div class="modal-footer border-0 justify-content-start">
            <button class="btn btn-primary" type="button">En savoir plus</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal-->
    <div class="modal fade" id="plus-initiative" tabindex="-1" role="dialog" aria-labelledby="plus-initiativeTitle" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <form class="modal-content plus-init-form">
          <div class="modal-header bg-pink text-white">
            <h4 class="modal-title">Ajouter une initiative</h4>
            <button class="btn-close" type="button" data-dismiss="modal" aria-label="Close"><span class="fa fa-close text-white" aria-hidden="true"></span></button>
          </div>
          <div class="modal-body">
            <div class="form-group"><i class="fa fa-user"></i>
              <input class="form-control" id="init-title" type="text" placeholder="Titre"/>
            </div>
            <div class="form-group"><i class="fa fa-pencil-square-o"></i>
              <input class="form-control" id="init-descr" type="text" placeholder="Detail"/>
            </div>
            <div class="form-group"><i class="fa fa-list-alt"></i>
              <input class="form-control" id="datetimepicker4" type="text" placeholder="Engagements citoyens "/>
            </div>
            <div class="form-group"><i class="fa fa-map-marker"></i>
              <input class="form-control" id="pac-input" type="text" name="keyword" placeholder="Localisation"/>
              <button class="btn btn-warning text-white"><i class="fa fa-location-arrow"></i>Localiser</button>
            </div>
          </div>
          <div class="modal-footer border-0 justify-content-center">
            <button class="btn btn-pink">Ajouter</button>
          </div>
        </form>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js"></script>
    <script>
      $(function () {
          $('#datetimepicker4').datetimepicker({format: 'YYYY-MM-DD'});
      });
      var popTemplate = [
          '<div class="popover" style="max-width:600px;" >',
          '<div class="arrow"></div>',
          '<div class="popover-header bg-pink text-white p-1">',
          '<button id="closepopover" type="button" class="close" aria-hidden="true">&times;</button>',
          '<h3 class="popover-title"></h3>',
          '</div>',
          '<div class="popover-content">',
          '</div>',
          '</div>'].join('');
      
      var date = new Date();
      var d = date.getDate();
      var m = date.getMonth();
      var y = date.getFullYear();
      var blue =  "#00bfe3";
      var indigo =  "#6610f2";
      var pink   =  "#d92988";
      var pinkdark =  "#a90c45";
      var red    =  "#B50E0B";
      var orange =  "#fd7e14";
      var yellow =  "#fdb32a";
      var green =  "#96B314";
      var teal =  "#16a085";
      var cyan   =  "#17a2b8";
      var gray =  "#f4f3f3";
      var dark =  "#2a2a2f";
      
      $('#calendar-01').fullCalendar({
          header: {
              left: 'prev',
              center: 'title',
              right: 'next'
          },
          defaultView: 'month',
          displayEventTime: false,
          eventLimit: true,
          events: [
          {
              title: 'Naturalia Tolbiac -1',
              start: new Date(y, m, d + 4, 16, 0),
              color: pink,
              placement: 'bottom',
              text: "71, rue de Tolbiac,' + <br> + 'PARIS 75013,' + <br> + ' Magasin vrac",
      
          }, {
              title: 'Naturalia Tolbiac -2',
              start: new Date(y, m, d, 10, 30),
              color: blue
          }, {
              title: 'Naturalia Tolbiac -3',
              start: new Date(y, m, d, 12, 0),
              color: orange
          }, {
              title: 'Naturalia Tolbiac -10',
              start: new Date(y, m, d, 12, 0),
              color: red
          }, {
              title: 'Naturalia Tolbiac -11',
              start: new Date(y, m, d, 12, 0),
              color: pinkdark
          }, {
              title: 'Naturalia Tolbiac -4',
              start: new Date(y, m, d + 1, 19, 0),
              color: green
          },
      
          ],
      
          select: function (start, end, jsEvent) {
              closePopovers();
              popoverElement = $(jsEvent.target);
              $(jsEvent.target).popover({
                  title: 'the title',
                  content: function () {
                      return $("#popoverContent").html();
                  },
                  template: popTemplate,
                  //placement: 'auto',
                  placement: function (context, source) {
                      var position = $(source).position();
                      var content_width = document.getElementsByClassName('clientWidth').clientWidth;  //Can be found from a JS function for more dynamic output
                      var content_height = 110;  //Can be found from a JS function for more dynamic output
                      if (position.left > content_width) {
                          return "left";
                      }
                      if (position.left < content_width) {
                          return "right";
                      }
                      if (position.top < content_height) {
                          return "bottom";
                      }
                      return "top";
                  },
                  html: 'true',
                  trigger: 'click',
                  animation: 'true',
                  container: 'body'
      
              }).popover('show');
          },
      
          eventClick: function (calEvent, jsEvent, view) {
              //closePopovers();
              popoverElement = $(jsEvent.currentTarget);
          },
      
          eventRender: function (event, element) {
              element.popover({
                  title: event.title,
                  content: function () {
                      return $("#popoverContent").html();
                  },
                  template: popTemplate,
                  //placement: 'auto',
                  placement: function (context, source) {
                      var position = $(source).position();
                      var content_width = document.getElementsByClassName('clientWidth').clientWidth;  //Can be found from a JS
                      // function for more dynamic output
                      var content_height = 110;  //Can be found from a JS function for more dynamic output
      
                      if (position.left > content_width) {
                          return "left";
                      }
      
                      if (position.left < content_width) {
                          return "right";
                      }
                      if (position.top < content_height) {
                          return "bottom";
                      }
      
                      return "top";
                  },
                  html: 'true',
                  trigger: 'click',
                  animation: 'true',
                  container: 'body'
              });
      
          },
          eventAfterAllRender: function () {
              $('.fc-row.fc-week.fc-widget-content').attr('style', 'height: 140px ');
          }
      
      });
      
      
      var popoverElement;
      
      function closePopovers() {
          $('.popover').not(this).popover('hide');
      }
      if($('.modal[aria-hidden="true"]')){
          closePopovers();
      }
      
      $('body').on('click', function (e) {
          // close the popover if: click outside of the popover || click on the close button of the popover
          if (popoverElement && ((!popoverElement.is(e.target) && popoverElement.has(e.target).length === 0 && $('.popover').has(e.target).length === 0) || (popoverElement.has(e.target) && e.target.id === 'closepopover'))) {
      
              ///$('.popover').popover('hide'); --> works
              closePopovers();
          }
      });
    </script>
  </body>
</html>