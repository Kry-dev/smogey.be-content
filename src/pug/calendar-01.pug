<!DOCTYPE html>
html(lang="en")
    include global/head
    +head('Smogey Calendar')

    include mixin/all-mixin
    body.homepage
        .wrapper
            article.calendar
                .container.py-5
                    .row.mb-20
                        #calendar-01
                        #popoverContent.hide
                            .row.p-3
                                .col-xs-9
                                    p
                                        | 71, rue de Tolbiac,
                                        br
                                        |  PARIS 75013,
                                        br
                                        |  Magasin vrac
                                    button.btn.btn-success.w-100.text-center(type='button', data-toggle='modal',data-target='#mapMarkerModal')
                                        |  More information
                                .col-xs-3
                                    img.img-responsive.m-auto(src='assets/img/calendar/pin-01.png')

        //// Modal
        #mapMarkerModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='mapMarkerModalTitle', aria-hidden='true')
            .modal-dialog(role='document')
                .modal-content
                    .modal-header.bg-pink.text-white
                        h4.modal-title Naturalia Tolbiac
                        button.btn-close(type='button', data-dismiss='modal', aria-label='Close')
                            span.fa.fa-close.text-white(aria-hidden='true')
                    .modal-body
                        .row.mb-20
                            .col-sm-6.mb-3
                                img.w-100(src='assets/img/map/map-modal-01.jpg')
                            .col-sm-6.mb-3
                                #map-canvas(style='width: 100%; height: 200px;')

                        p.mb-0
                            | Depuis quelques jours, la Ville de Tournai constate que des sacs poubelles d’ordures ménagères apparaissent à différents endroits de l’entité à des jours inappropriés alors que le calendrier de ramassage de ces poubelles.
                    .modal-footer.border-0.justify-content-start
                        button.btn.btn-primary(type='button') En savoir plus

        script(src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js")
        script.
            var popTemplate = [
                '<div class="popover" style="max-width:600px;" >',
                '<div class="arrow"></div>',
                '<div class="popover-header bg-pink text-white p-1">',
                '<button id="closepopover" type="button" class="close" aria-hidden="true">&times;</button>',
                '<h3 class="popover-title"></h3>',
                '</div>',
                '<div class="popover-content">',
                '</div>',
                '</div>'].join('');

            var date = new Date();
            var d = date.getDate();
            var m = date.getMonth();
            var y = date.getFullYear();
            var blue =  "#00bfe3";
            var indigo =  "#6610f2";
            var pink   =  "#d92988";
            var pinkdark =  "#a90c45";
            var red    =  "#B50E0B";
            var orange =  "#fd7e14";
            var yellow =  "#fdb32a";
            var green =  "#96B314";
            var teal =  "#16a085";
            var cyan   =  "#17a2b8";
            var gray =  "#f4f3f3";
            var dark =  "#2a2a2f";

            $('#calendar-01').fullCalendar({
                header: {
                    left: 'prev',
                    center: 'title',
                    right: 'next'
                },
                defaultView: 'month',
                selectable: false,
                selectHelper: false,
                editable: true,
                displayEventTime: false,
                events: [
                {
                    title: 'Naturalia Tolbiac -1',
                    start: new Date(y, m, d + 4, 16, 0),
                    color: pink,
                    text: "71, rue de Tolbiac,' + <br> + 'PARIS 75013,' + <br> + ' Magasin vrac",

                }, {
                    title: 'Naturalia Tolbiac -2',
                    start: new Date(y, m, d, 10, 30),
                    color: blue
                }, {
                    title: 'Naturalia Tolbiac -3',
                    start: new Date(y, m, d, 12, 0),
                    color: orange
                }, {
                    title: 'Naturalia Tolbiac -4',
                    start: new Date(y, m, d + 1, 19, 0),
                    color: green
                }, {
                    title: 'Naturalia Tolbiac -5',
                    start: new Date(y, m, d + 1, 19, 0),
                    color: yellow
                },

                ],

                select: function (start, end, jsEvent) {
                    closePopovers();
                    popoverElement = $(jsEvent.target);
                    $(jsEvent.target).popover({
                        title: 'the title',
                        content: function () {
                            return $("#popoverContent").html();
                        },
                        template: popTemplate,
                        placement: 'top',
                        html: 'true',
                        trigger: 'click',
                        animation: 'true',
                        container: 'body'
                    }).popover('show');
                },

                eventClick: function (calEvent, jsEvent, view) {
                    //closePopovers();
                    popoverElement = $(jsEvent.currentTarget);
                },

                eventRender: function (event, element) {
                    element.popover({
                        title: event.title,
                        content: function () {
                            return $("#popoverContent").html();
                        },
                        template: popTemplate,
                        placement: 'top',
                        html: 'true',
                        trigger: 'click',
                        animation: 'true',
                        container: 'body'
                    });

                },

            });


            var popoverElement;

            function closePopovers() {
                $('.popover').not(this).popover('hide');
            }
            if($('.modal[aria-hidden="true"]')){
                closePopovers();
            }

            $('body').on('click', function (e) {
                // close the popover if: click outside of the popover || click on the close button of the popover
                if (popoverElement && ((!popoverElement.is(e.target) && popoverElement.has(e.target).length === 0 && $('.popover').has(e.target).length === 0) || (popoverElement.has(e.target) && e.target.id === 'closepopover'))) {

                    ///$('.popover').popover('hide'); --> works
                    closePopovers();
                }
            });






